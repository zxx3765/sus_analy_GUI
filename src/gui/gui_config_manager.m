function handles = gui_config_manager(parent, handles)
%% é…ç½®ç®¡ç†æ¨¡å—
% è´Ÿè´£åˆ†æé…ç½®çš„è®¾ç½®å’Œç®¡ç†
%
% åŠŸèƒ½:
% - åŸºæœ¬é…ç½®è®¾ç½® (æ¨¡å‹ç±»å‹ã€è¯­è¨€)
% - è¾“å‡ºè®¾ç½® (ä¿å­˜é€‰é¡¹ã€æ ¼å¼é€‰æ‹©)
% - åˆ†æç±»å‹é€‰æ‹©
% - é«˜çº§é€‰é¡¹è®¾ç½®
% - é…ç½®çš„ä¿å­˜å’ŒåŠ è½½
%
% è¾“å…¥:
%   parent - çˆ¶å®¹å™¨å¯¹è±¡
%   handles - GUIå¥æŸ„ç»“æ„ä½“
%
% è¾“å‡º:  
%   handles - æ›´æ–°åçš„å¥æŸ„ç»“æ„ä½“

    % é…ç½®é¢æ¿ - è°ƒæ•´é«˜åº¦
    configPanel = uipanel('Parent', parent, ...
                         'Title', 'âš™ï¸ åˆ†æé…ç½®', ...
                         'Position', [0.02, 0.02, 0.96, 0.72], ...
                         'FontSize', 10, ...
                         'FontWeight', 'bold', ...
                         'ForegroundColor', [0.2, 0.6, 0.2]);
    
    %% åŸºæœ¬é…ç½®åŒºåŸŸ
    y_pos = 520;
    
    % åŸºæœ¬è®¾ç½®åˆ†ç»„
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'ğŸ“‹ åŸºæœ¬è®¾ç½®', ...
              'Position', [10, y_pos+15, 100, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 10, ...
              'FontWeight', 'bold', ...
              'ForegroundColor', [0.3, 0.3, 0.7]);
    
    % æ¨¡å‹ç±»å‹
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'æ¨¡å‹ç±»å‹:', ...
              'Position', [15, y_pos-5, 70, 18], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 9);
    
    handles.modelTypePopup = uicontrol('Parent', configPanel, ...
                                      'Style', 'popupmenu', ...
                                      'String', {'åŠè½¦æ¨¡å‹ (Half-car)', 'å››åˆ†ä¹‹ä¸€è½¦æ¨¡å‹ (Quarter-car)'}, ...
                                      'Position', [95, y_pos-7, 190, 25], ...
                                      'FontSize', 9, ...
                                      'BackgroundColor', 'white', ...
                                      'Callback', {@updateConfig, handles});
    
    % è¯­è¨€è®¾ç½®
    y_pos = y_pos - 30;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'ç•Œé¢è¯­è¨€:', ...
              'Position', [15, y_pos, 70, 18], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 9);
    
    handles.languagePopup = uicontrol('Parent', configPanel, ...
                                     'Style', 'popupmenu', ...
                                     'String', {'ä¸­æ–‡ (CN)', 'è‹±æ–‡ (EN)'}, ...
                                     'Position', [95, y_pos-2, 130, 25], ...
                                     'FontSize', 9, ...
                                     'BackgroundColor', 'white', ...
                                     'Callback', {@updateConfig, handles});
    
    %% è¾“å‡ºè®¾ç½®åˆ†ç»„
    y_pos = y_pos - 50;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'ğŸ’¾ è¾“å‡ºè®¾ç½®', ...
              'Position', [10, y_pos+15, 100, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 10, ...
              'FontWeight', 'bold', ...
              'ForegroundColor', [0.6, 0.3, 0.6]);
    
    y_pos = y_pos - 10;
    % ä¿å­˜å›¾ç‰‡é€‰é¡¹
    y_pos = y_pos - 30;
    handles.savePlotsCheck = uicontrol('Parent', configPanel, ...
                                      'Style', 'checkbox', ...
                                      'String', 'ä¿å­˜å›¾ç‰‡', ...
                                      'Position', [10, y_pos, 80, 20], ...
                                      'Value', 1, ...
                                      'FontSize', 9, ...
                                      'Callback', {@updateConfig, handles});
    
    % å›¾ç‰‡æ ¼å¼
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'æ ¼å¼:', ...
              'Position', [100, y_pos, 40, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 9);
    
    handles.plotFormatPopup = uicontrol('Parent', configPanel, ...
                                       'Style', 'popupmenu', ...
                                       'String', {'PNG', 'EPS', 'PDF'}, ...
                                       'Position', [140, y_pos-2, 70, 25], ...
                                       'FontSize', 9, ...
                                       'BackgroundColor', 'white', ...
                                       'Callback', {@updateConfig, handles});
    
    % ä¿å­˜.figæ–‡ä»¶é€‰é¡¹
    y_pos = y_pos - 25;
    handles.saveFigFilesCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'ä¿å­˜.figæ–‡ä»¶', ...
                                         'Position', [10, y_pos, 100, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    % å…³é—­å›¾çª—é€‰é¡¹
    handles.closeFiguresCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'ä¿å­˜åå…³é—­å›¾çª—', ...
                                         'Position', [120, y_pos, 120, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    %% æ—¶é—´æˆ³æ–‡ä»¶å¤¹è®¾ç½®
    y_pos = y_pos - 35;
    handles.useTimestampCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'ä½¿ç”¨æ—¶é—´æˆ³æ–‡ä»¶å¤¹', ...
                                         'Position', [10, y_pos, 130, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    % è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å¤¹
    y_pos = y_pos - 30;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'è¾“å‡ºæ–‡ä»¶å¤¹:', ...
              'Position', [10, y_pos, 80, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 9);
    
    handles.outputFolderEdit = uicontrol('Parent', configPanel, ...
                                        'Style', 'edit', ...
                                        'Position', [90, y_pos, 200, 22], ...
                                        'FontSize', 9, ...
                                        'Enable', 'off', ...
                                        'BackgroundColor', [0.95, 0.95, 0.95], ...
                                        'Callback', {@updateConfig, handles});
    
    uicontrol('Parent', configPanel, ...
              'Style', 'pushbutton', ...
              'String', 'æµè§ˆ', ...
              'Position', [295, y_pos, 50, 22], ...
              'FontSize', 8, ...
              'BackgroundColor', [0.9, 0.95, 1], ...
              'Callback', {@browseOutputFolder, handles});
    
    % åˆ†æç±»å‹åˆ†ç»„
    y_pos = y_pos - 50;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'ğŸ“ˆ åˆ†æç±»å‹', ...
              'Position', [10, y_pos+15, 100, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 10, ...
              'FontWeight', 'bold', ...
              'ForegroundColor', [0.3, 0.6, 0.3]);
    
    y_pos = y_pos - 10;
    handles.freqAnalysisCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'é¢‘ç‡å“åº”åˆ†æ', ...
                                         'Position', [15, y_pos, 130, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    handles.timeAnalysisCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'æ—¶åŸŸå“åº”åˆ†æ', ...
                                         'Position', [155, y_pos, 130, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    y_pos = y_pos - 25;
    handles.rmsAnalysisCheck = uicontrol('Parent', configPanel, ...
                                        'Style', 'checkbox', ...
                                        'String', 'RMSå¯¹æ¯”åˆ†æ', ...
                                        'Position', [15, y_pos, 130, 20], ...
                                        'Value', 1, ...
                                        'FontSize', 9, ...
                                        'Callback', {@updateConfig, handles});
    
    handles.statAnalysisCheck = uicontrol('Parent', configPanel, ...
                                         'Style', 'checkbox', ...
                                         'String', 'ç»Ÿè®¡åˆ†æ', ...
                                         'Position', [155, y_pos, 130, 20], ...
                                         'Value', 1, ...
                                         'FontSize', 9, ...
                                         'Callback', {@updateConfig, handles});
    
    %% é«˜çº§é€‰é¡¹åˆ†ç»„
    y_pos = y_pos - 60;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'âš™ï¸ é«˜çº§é€‰é¡¹', ...
              'Position', [10, y_pos+15, 100, 20], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 10, ...
              'FontWeight', 'bold', ...
              'ForegroundColor', [0.7, 0.3, 0.3]);
    
    % å‚è€ƒé¢‘ç‡
    y_pos = y_pos - 10;
    uicontrol('Parent', configPanel, ...
              'Style', 'text', ...
              'String', 'å‚è€ƒé¢‘ç‡ (Hz):', ...
              'Position', [15, y_pos, 100, 18], ...
              'HorizontalAlignment', 'left', ...
              'FontSize', 9);
    
    handles.refFreqEdit = uicontrol('Parent', configPanel, ...
                                   'Style', 'edit', ...
                                   'String', '1, 10', ...
                                   'Position', [120, y_pos-2, 100, 22], ...
                                   'FontSize', 9, ...
                                   'BackgroundColor', 'white', ...
                                   'Callback', {@updateConfig, handles});
    
    % é…ç½®ç®¡ç†æŒ‰é’® - ä¼˜åŒ–å¸ƒå±€
    y_pos = y_pos - 50;
    uicontrol('Parent', configPanel, ...
              'Style', 'pushbutton', ...
              'String', 'ğŸ”„ é»˜è®¤é…ç½®', ...
              'Position', [15, y_pos, 90, 28], ...
              'FontSize', 9, ...
              'FontWeight', 'bold', ...
              'BackgroundColor', [0.9, 0.95, 1], ...
              'Callback', {@loadDefaultConfig, handles});
    
    uicontrol('Parent', configPanel, ...
              'Style', 'pushbutton', ...
              'String', 'ğŸ’¾ ä¿å­˜é…ç½®', ...
              'Position', [115, y_pos, 90, 28], ...
              'FontSize', 9, ...
              'FontWeight', 'bold', ...
              'BackgroundColor', [0.9, 1, 0.9], ...
              'Callback', {@saveConfig, handles});
    
    uicontrol('Parent', configPanel, ...
              'Style', 'pushbutton', ...
              'String', 'ğŸ“ åŠ è½½é…ç½®', ...
              'Position', [215, y_pos, 90, 28], ...
              'FontSize', 9, ...
              'FontWeight', 'bold', ...
              'BackgroundColor', [1, 0.98, 0.9], ...
              'Callback', {@loadConfig, handles});

end

%% æ›´æ–°é…ç½®
function updateConfig(src, ~, handles)
    handles = get(handles.fig, 'UserData');
    
    try
        % è·å–GUIæ§ä»¶å€¼
        model_types = {'half', 'quarter'};
        model_type = model_types{get(handles.modelTypePopup, 'Value')};
        
        languages = {'cn', 'en'};
        language = languages{get(handles.languagePopup, 'Value')};
        
        % ç¡®ä¿checkboxå€¼è½¬æ¢ä¸ºé€»è¾‘ç±»å‹
        save_plots = logical(get(handles.savePlotsCheck, 'Value'));
        save_fig_files = logical(get(handles.saveFigFilesCheck, 'Value'));
        close_figures = logical(get(handles.closeFiguresCheck, 'Value'));
        
        formats = {'png', 'eps', 'pdf'};
        plot_format = formats{get(handles.plotFormatPopup, 'Value')};
        
        % ç¡®ä¿æ‰€æœ‰checkboxå€¼éƒ½è½¬æ¢ä¸ºé€»è¾‘ç±»å‹
        use_timestamp = logical(get(handles.useTimestampCheck, 'Value'));
        output_folder = get(handles.outputFolderEdit, 'String');
        
        % æ›´æ–°æ—¶é—´æˆ³æ–‡ä»¶å¤¹è®¾ç½®çš„ç•Œé¢çŠ¶æ€
        if use_timestamp
            set(handles.outputFolderEdit, 'Enable', 'off');
        else
            set(handles.outputFolderEdit, 'Enable', 'on');
        end
        
        % åˆ›å»ºæ–°é…ç½®
        if use_timestamp || isempty(output_folder)
            config = quick_config('ModelType', model_type, ...
                                 'Language', language, ...
                                 'SavePlots', save_plots, ...
                                 'SaveFigFiles', save_fig_files, ...
                                 'CloseFigures', close_figures, ...
                                 'UseTimestamp', true, ...
                                 'PlotFormat', plot_format);
        else
            config = quick_config('ModelType', model_type, ...
                                 'Language', language, ...
                                 'SavePlots', save_plots, ...
                                 'SaveFigFiles', save_fig_files, ...
                                 'CloseFigures', close_figures, ...
                                 'UseTimestamp', false, ...
                                 'OutputFolder', output_folder, ...
                                 'PlotFormat', plot_format);
        end
        
        % æ›´æ–°åˆ†æé€‰é¡¹ - ç¡®ä¿æ‰€æœ‰checkboxå€¼éƒ½è½¬æ¢ä¸ºé€»è¾‘ç±»å‹
        config.analysis.frequency_response = logical(get(handles.freqAnalysisCheck, 'Value'));
        config.analysis.time_domain = logical(get(handles.timeAnalysisCheck, 'Value'));
        config.analysis.rms_comparison = logical(get(handles.rmsAnalysisCheck, 'Value'));
        config.analysis.statistical = logical(get(handles.statAnalysisCheck, 'Value'));
        
        % æ›´æ–°å‚è€ƒé¢‘ç‡
        ref_freq_str = get(handles.refFreqEdit, 'String');
        try
            ref_freq = str2num(ref_freq_str); %#ok<ST2NM>
            if isnumeric(ref_freq) && ~isempty(ref_freq)
                config.plot.reference_lines = ref_freq;
            end
        catch
            % å¿½ç•¥å‚è€ƒé¢‘ç‡è§£æé”™è¯¯
        end
        
        % ä¿å­˜é…ç½®ï¼Œå¹¶ä¿ç•™å·²æœ‰çš„æ•°æ®é¡ºåºæ˜ å°„ï¼ˆå¦‚æœæœ‰ï¼‰
        if isfield(handles, 'config') && isfield(handles.config, 'data_order_mapping')
            config.data_order_mapping = handles.config.data_order_mapping;
        end
        handles.config = config;
        handles.results_folder = config.output_folder;
        
        % æ£€æŸ¥æ¨¡å‹ç±»å‹æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå˜åŒ–åˆ™æ›´æ–°ä¿¡å·åˆ—è¡¨
        if isfield(handles, 'previous_model_type')
            if ~strcmp(handles.previous_model_type, model_type)
                % æ¨¡å‹ç±»å‹å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°ä¿¡å·åˆ—è¡¨
                if isfield(handles, 'signalList')
                    gui_utils('updateSignalList', model_type, handles);
                end
            end
        else
            % ç¬¬ä¸€æ¬¡è®¾ç½®ï¼Œä¹Ÿæ›´æ–°ä¿¡å·åˆ—è¡¨
            if isfield(handles, 'signalList')
                gui_utils('updateSignalList', model_type, handles);
            end
        end
        handles.previous_model_type = model_type;
        
        % æ›´æ–°ç»“æœæ–‡ä»¶å¤¹æ˜¾ç¤º
        if isfield(handles, 'resultsFolderText')
            set(handles.resultsFolderText, 'String', config.output_folder);
        end
        
        % ä¿å­˜handles
        set(handles.fig, 'UserData', handles);
        
    catch ME
        gui_utils('addLog', handles, sprintf('é…ç½®æ›´æ–°å¤±è´¥: %s', ME.message));
    end
end

%% æµè§ˆè¾“å‡ºæ–‡ä»¶å¤¹
function browseOutputFolder(~, ~, handles)
    handles = get(handles.fig, 'UserData');
    
    folder = uigetdir(pwd, 'é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹');
    if folder ~= 0
        set(handles.outputFolderEdit, 'String', folder);
        updateConfig([], [], handles);
    end
end

%% åŠ è½½é»˜è®¤é…ç½®
function loadDefaultConfig(~, ~, handles)
    handles = get(handles.fig, 'UserData');
    
    try
        config = quick_config('half', 'cn', true);
        handles.config = config;
        handles.results_folder = config.output_folder;
        
        updateGUIFromConfig(handles);
        if isfield(handles, 'resultsFolderText')
            set(handles.resultsFolderText, 'String', config.output_folder);
        end
        
        % æ›´æ–°ä¿¡å·åˆ—è¡¨ä¸ºé»˜è®¤åŠè½¦æ¨¡å‹
        if isfield(handles, 'signalList')
            gui_utils('updateSignalList', 'half', handles);
        end
        handles.previous_model_type = 'half';
        
        gui_utils('addLog', handles, 'å·²åŠ è½½é»˜è®¤é…ç½®');
        set(handles.fig, 'UserData', handles);
    catch ME
        gui_utils('addLog', handles, sprintf('åŠ è½½é»˜è®¤é…ç½®å¤±è´¥: %s', ME.message));
    end
end

%% ä¿å­˜é…ç½®
function saveConfig(~, ~, handles)
    handles = get(handles.fig, 'UserData');
    
    if isempty(handles.config)
        msgbox('æ²¡æœ‰é…ç½®å¯ä¿å­˜', 'æç¤º', 'warn');
        return;
    end
    
    [filename, pathname] = uiputfile('*.mat', 'ä¿å­˜é…ç½®æ–‡ä»¶', 'suspension_config.mat');
    
    if isequal(filename, 0)
        return;
    end
    
    try
        config = handles.config; %#ok<NASGU>
        save(fullfile(pathname, filename), 'config');
        gui_utils('addLog', handles, sprintf('é…ç½®å·²ä¿å­˜è‡³: %s', filename));
        msgbox('é…ç½®ä¿å­˜æˆåŠŸ', 'æç¤º', 'help');
    catch ME
        gui_utils('addLog', handles, sprintf('ä¿å­˜é…ç½®å¤±è´¥: %s', ME.message));
        msgbox('é…ç½®ä¿å­˜å¤±è´¥', 'é”™è¯¯', 'error');
    end
end

%% åŠ è½½é…ç½®
function loadConfig(~, ~, handles)
    handles = get(handles.fig, 'UserData');
    
    [filename, pathname] = uigetfile('*.mat', 'åŠ è½½é…ç½®æ–‡ä»¶');
    
    if isequal(filename, 0)
        return;
    end
    
    try
        loaded_data = load(fullfile(pathname, filename));
        if isfield(loaded_data, 'config')
            handles.config = loaded_data.config;
            handles.results_folder = handles.config.output_folder;
            
            updateGUIFromConfig(handles);
            if isfield(handles, 'resultsFolderText')
                set(handles.resultsFolderText, 'String', handles.config.output_folder);
            end
            
            % æ ¹æ®åŠ è½½çš„é…ç½®æ›´æ–°ä¿¡å·åˆ—è¡¨
            if isfield(handles, 'signalList') && isfield(handles.config, 'model_type')
                gui_utils('updateSignalList', handles.config.model_type, handles);
                handles.previous_model_type = handles.config.model_type;
            end
            
            gui_utils('addLog', handles, sprintf('é…ç½®å·²ä» %s åŠ è½½', filename));
            set(handles.fig, 'UserData', handles);
            msgbox('é…ç½®åŠ è½½æˆåŠŸ', 'æç¤º', 'help');
        else
            gui_utils('addLog', handles, 'é…ç½®æ–‡ä»¶æ ¼å¼æ— æ•ˆ');
            msgbox('é…ç½®æ–‡ä»¶æ ¼å¼æ— æ•ˆ', 'é”™è¯¯', 'error');
        end
    catch ME
        gui_utils('addLog', handles, sprintf('åŠ è½½é…ç½®å¤±è´¥: %s', ME.message));
        msgbox('é…ç½®åŠ è½½å¤±è´¥', 'é”™è¯¯', 'error');
    end
end

%% ä»é…ç½®æ›´æ–°GUIæ§ä»¶ (ç®€åŒ–ç‰ˆæœ¬ï¼Œä¸»è¦åŠŸèƒ½åœ¨main_gui.mä¸­)
function updateGUIFromConfig(handles)
    if isempty(handles.config)
        return;
    end
    
    config = handles.config;
    
    % æ¨¡å‹ç±»å‹
    if isfield(handles, 'modelTypePopup')
        if strcmp(config.model_type, 'half')
            set(handles.modelTypePopup, 'Value', 1);
        else
            set(handles.modelTypePopup, 'Value', 2);
        end
    end
    
    % è¯­è¨€
    if isfield(handles, 'languagePopup')
        if strcmp(config.language, 'cn')
            set(handles.languagePopup, 'Value', 1);
        else
            set(handles.languagePopup, 'Value', 2);
        end
    end
    
    % ä¿å­˜é€‰é¡¹
    if isfield(handles, 'savePlotsCheck')
        set(handles.savePlotsCheck, 'Value', config.save_plots);
    end
    
    if isfield(config, 'save_fig_files') && isfield(handles, 'saveFigFilesCheck')
        set(handles.saveFigFilesCheck, 'Value', config.save_fig_files);
    end
    
    if isfield(config, 'close_figures') && isfield(handles, 'closeFiguresCheck')
        set(handles.closeFiguresCheck, 'Value', config.close_figures);
    end
    
    % å›¾ç‰‡æ ¼å¼
    if isfield(handles, 'plotFormatPopup')
        formats = {'png', 'eps', 'pdf'};
        format_idx = find(strcmp(config.plot_format, formats), 1);
        if ~isempty(format_idx)
            set(handles.plotFormatPopup, 'Value', format_idx);
        end
    end
    
    % æ—¶é—´æˆ³æ–‡ä»¶å¤¹
    if isfield(config, 'use_timestamp_folder') && isfield(handles, 'useTimestampCheck')
        set(handles.useTimestampCheck, 'Value', config.use_timestamp_folder);
        if config.use_timestamp_folder && isfield(handles, 'outputFolderEdit')
            set(handles.outputFolderEdit, 'Enable', 'off');
        elseif isfield(handles, 'outputFolderEdit')
            set(handles.outputFolderEdit, 'Enable', 'on');
            set(handles.outputFolderEdit, 'String', config.output_folder);
        end
    end
    
    % åˆ†æé€‰é¡¹
    if isfield(config, 'analysis')
        if isfield(handles, 'freqAnalysisCheck')
            set(handles.freqAnalysisCheck, 'Value', config.analysis.frequency_response);
        end
        if isfield(handles, 'timeAnalysisCheck')
            set(handles.timeAnalysisCheck, 'Value', config.analysis.time_domain);
        end
        if isfield(handles, 'rmsAnalysisCheck')
            set(handles.rmsAnalysisCheck, 'Value', config.analysis.rms_comparison);
        end
        if isfield(handles, 'statAnalysisCheck')
            set(handles.statAnalysisCheck, 'Value', config.analysis.statistical);
        end
    end
    
    % å‚è€ƒé¢‘ç‡
    if isfield(config, 'plot') && isfield(config.plot, 'reference_lines') && isfield(handles, 'refFreqEdit')
        if ~isempty(config.plot.reference_lines)
            ref_str = sprintf('%.1f, ', config.plot.reference_lines);
            ref_str = ref_str(1:end-2); % ç§»é™¤æœ€åçš„é€—å·å’Œç©ºæ ¼
            set(handles.refFreqEdit, 'String', ref_str);
        end
    end
end